const axios = require("axios");
const cheerio = require("cheerio");
const header = {
  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
  'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36'
}


const popularToday = async () => {
  const url = "https://asuracomics.com/";
  const res = await axios.get(url, { header })
  const $ = cheerio.load(res.data)

  const data = [];
  let img = [];
  let title = [];
  let rating = [];
  let series = [];

  $('.limit img').each((i, el) => {
    let image = $(el).attr('src')
    if (image !== '') {
      img.push(image)
    }
  })


  $('.tt').each((i, el) => {
    let titles = $(el).text().split("\n")[1]
    title.push(titles)
  })


  $('.numscore').each((i, el) => {
    let ratings = $(el).text()
    rating.push(ratings)
  })


  $('.bsx a').each((i, el) => {
    let serieses = $(el).attr('href')
    series.push(serieses)
  })

  for (let i = 0; i < img.length; i++) {
    let datas = {
      image: img[i],
      title: title[i],
      ratings: rating[i],
      series_link: series[i],
    }
    data.push(datas)
  }
  return data;
}
module.exports = popularToday