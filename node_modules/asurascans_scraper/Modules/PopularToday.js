const axios = require("axios");
const cheerio = require("cheerio");
const header = {
  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
  'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36'
}


const popularToday = async () => {
  try{
  const url = "https://asuracomics.com/";
  const res = await axios.get(url, { header })
  const $ = cheerio.load(res.data)

  const data = [];
  
  let img = $('.limit img')
    .map((i,el) =>  {
      if($(el).attr('src') !== '') return $(el).attr('src')
    })

 let title = $('.tt')
   .map((i, el) => 
     $(el).text().split("\n")[1])


let rating = $('.numscore')
  .map((i, el) => $(el).text())


let series = $('.bsx a').map((i, el) =>  $(el).attr('href')).get()
  

  for (let i = 0; i < img.length; i++) {
    let datas = {
      image: img[i],
      title: title[i],
      ratings: rating[i],
      series_id: series[i].replaceAll("https://asuratoon.com/manga/", ''),
    }
    data.push(datas)
  }
  return data;
  } catch (error) {
    return "An Error Occurred!!"+error
  }
}
module.exports = popularToday