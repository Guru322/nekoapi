const axios = require("axios");
const cheerio = require("cheerio");
const header = {
  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
  'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36'
}

const search = async (text = 'Dr. player', page = '1') => {
  const url = `https://asuratoon.com/page/${page}/?s=${text}`;
  const res = await axios.get(url, { header })
  const $ = cheerio.load(res.data)
  let data = [];
  let images = [];
  let link = [];
  let title = [];
  let last_ep = [];
  let rating = [];

  $('.bsx img').each((i, el) => {
    let img = $(el).attr('src')
    images.push(img);
  })
  if (images == "[]") return `Not Found!!`

  $('.bsx a').each((i, el) => {
    let links = $(el).attr('href')
    link.push(links);
  })

  $('.bsx a').each((i, el) => {
    let titles = $(el).attr('title')
    title.push(titles);
  })

  $('.epxs').each((i, el) => {
    let last_eps = $(el).text()
    last_ep.push(last_eps);
  })

  $('.numscore').each((i, el) => {
    let ratings = $(el).text()
    rating.push(ratings);
  })

  for (let i = 0; i < images.length; i++) {
    let datas = {
      image: images[i],
      title: title[i],
      link: link[i],
      rating: rating[i],
      last_ep: last_ep[i]
    }
    data.push(datas)
  }
  return data;
}

module.exports = search