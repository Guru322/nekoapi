const axios = require("axios");
const cheerio = require("cheerio");


const header =  {
    Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'en-US,en;q=0.9',
    
    'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36'
  }

const dl = async(url) => {
  try {
  const res = await axios.get(url,{header})
  const r = [];
  const $ = await cheerio.load(res.data);
  $('#html5video_base a').each((i,el) => {
   let sr = $(el).attr('href')
    r.push(sr);
  })
  const data = {
    normal:r[0],
    best:r[2],
    lowest:r[1]
    }
    return data;
  } catch (error) {
     throw new Error(error);
  }
}


const search = async(text='sex',number ='') => {
  try {
let url = "https://www.xnxx.press/search/"+text+'/'+number
  const res = await axios.get(url,{header})
  const r = [];
  const $ = await cheerio.load(res.data);
  $('div.thumb a').each((i,el) => {
   let sr = $(el).attr('href')
    r.push(sr);
  })
    let data2 = [];
    for (let i = 0; i < r.length; i++) {
       data = 'https://www.xnxx.press'+r[i];
       data2.push(data)
    }
    return data2;
  } catch (error) {
     throw new Error(error);
  }
      }

const searchdl = async (text='sex',number='') => {
  try {
    let res = await search(text,number) 
    let download = []
    for (let i = 0; i < 8; i++) {
      let response = await dl(res[i])     
      download.push(response)
      } 
    return download;
    } catch (error) {
     throw new Error(error)
  }
}

const searchdlsingle = async (text='sex',number='') => {
  try {
    let res = await search(text,number)
   let random = res[Math.floor(Math.random() * res.length)]
    let response = await dl(random)
    return response;
    } catch (error) {
     throw new Error(error)
  }
}


module.exports = {
  dl,search,searchdl,searchdlsingle
}